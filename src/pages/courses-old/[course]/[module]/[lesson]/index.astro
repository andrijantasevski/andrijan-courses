---
import LayoutFocusMode from "@layouts/LayoutFocusMode.astro";
import { generateCourseTree } from "src/utils/generateCourseTree.astro";
import type { Lesson } from "src/types/types";

const { course, module, lesson } = Astro.params;

if (!course || !module || !lesson) {
  return new Response(null, {
    status: 404,
    statusText: "Not found",
  });
}

const lessonPath = `/courses/${course}/${module}/${lesson}`;

const lessons = await Astro.glob<Lesson>("/content/courses/*/*/*.mdx");

const lessonFiltered = lessons.find((lesson) =>
  lesson.url?.includes(lessonPath)
);

if (!lessonFiltered) {
  return new Response(null, {
    status: 404,
    statusText: "Not found",
  });
}

const { frontmatter, Content, getHeadings } = lessonFiltered;

const headings = getHeadings();

const courseTree = await generateCourseTree(course);
---

<LayoutFocusMode courseTree={courseTree} title={frontmatter.lessonTitle}>
  <div class="mx-auto w-11/12 max-w-3xl py-10">
    <article class="prose max-w-none dark:prose-invert">
      <Content />
    </article>
  </div>
</LayoutFocusMode>
